---
import { format, parseISO } from 'date-fns'
import EditorLayout from '@layouts/EditorLayout.astro'
import { getLinks, getPosts } from '@api/index'
import { Link } from '@utils/types'

const links = await getLinks()

const current_tab = links.find(link => link.name === 'Blog') as Link

const posts = await getPosts()

const tabs = [
  current_tab,
  ...posts.map(post => ({
    name: post.title,
    icon: 'ooui:article-ltr',
    link: `/blog/${post.slug}`
  }))
]
---

<EditorLayout current_tab={current_tab} extension="index" links={links} tabs={tabs}>
  <div class="m-4">
    <div>I don't write often but when I do, it's still not often enough ðŸ˜¢</div>
    <div class="flex flex-col gap-4 mt-4">
      {posts.map(async post =>
      <div class="flex gap-4">
        <div class="flex flex-col items-center shrink-0">
          <div class="text-4xl text-brand-primary">{format(parseISO(post.date_created as string), 'dd')}</div>
          <div class="text-lg text-brand-secondary">{format(parseISO(post.date_created as string), 'MMM yyy')}
          </div>
        </div>
        <div class="flex-1">
          <a href={`/blog/${post.slug}`} class="text-xl no-underline" data-swup-preload>{post.title}</a>
          <div class="mt-1 line-clamp-2">{post.summary}</div>
          <div class="flex gap-2 mt-2">
            {post.tags && post.tags.map(tag =>
            <span class="pill">
              {tag.tags_id.name}
            </span>
            )}
          </div>
        </div>
      </div>
      )}
    </div>
  </div>
</EditorLayout>